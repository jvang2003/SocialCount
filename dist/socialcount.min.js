/*! SocialCount - v0.1.3 - 2012-11-23
* https://github.com/filamentgroup/SocialCount
* Copyright (c) 2012 zachleat; Licensed MIT */
(function(e,t,n){function s(e,n){var r=t.createElement("social").style,i="webkit Moz o ms".split(" ");if(n in r)return!0;for(var s=0,o=i.length;s<o;s++)if(i[s]+e in r)return!0;return!1}function o(e,t){var n={facebook:e.Facebook.total_count,twitter:e.Twitter,googleplus:e.GooglePlusOne};for(var r in n)n.hasOwnProperty(r)&&t[r]&&n[r]>u.minCount&&t[r].addClass(u.classes.minCount).html(u.normalizeCount(n[r]))}var r,i,u={isGradeA:"querySelectorAll"in t&&!e.blackberry&&!("ontouchstart"in window)&&!("onmsgesturechange"in window),minCount:1,sharedCountUrl:location.protocol==="https:"?"https://sharedcount.appspot.com/":"http://api.sharedcount.com/",initSelector:".socialcount",classes:{gradeA:"grade-a",active:"active",touch:"touch",noTransforms:"no-transforms",showCounts:"counts",countContent:"count",minCount:"minimum"},thousandCharacter:"K",millionCharacter:"M",missingResultText:"-",selectors:{facebook:".facebook",twitter:".twitter",googleplus:".googleplus"},plugins:{init:[],bind:[]},cache:{},isCssAnimations:function(){return s("AnimationName","animationName")},isCssTransforms:function(){return s("Transform","transform")},getUrl:function(e){return e.attr("data-url")||location.href},getFacebookAction:function(e){return(e.attr("data-facebook-action")||"like").toLowerCase()},isCountsEnabled:function(e){return e.attr("data-counts")==="true"},isSmallSize:function(e){return e.is(".socialcount-small")},getCounts:function(e,t){var r=u.selectors,s=u.cache,a={},f,l,c;for(c in r)f=e.find(r[c]),l=f.find("."+u.classes.countContent),l.length?a[c]=l:(a[c]=i.clone(),f.append(a[c]));return s[t]||(s[t]=n.ajax({url:u.sharedCountUrl,data:{url:t},dataType:"json"})),s[t].done(function(t){o(t,a)}),s[t]},init:function(e){var t=u.getFacebookAction(e),n=[t],r=u.isSmallSize(e),i=u.getUrl(e),s=u.plugins.init,o=u.isCountsEnabled(e);u.isGradeA&&n.push(u.classes.gradeA),u.isCssTransforms()||n.push(u.classes.noTransforms),o&&n.push(u.classes.showCounts),e.addClass(n.join(" "));for(var a=0,f=s.length;a<f;a++)s[a].call(e);u.isGradeA&&u.bindEvents(e,i,t,r),o&&!r&&u.getCounts(e,i)},normalizeCount:function(e){return!e&&e!==0?u.missingResultText:e>=1e6?Math.floor(e/1e6)+u.millionCharacter:e>=1e5?Math.floor(e/1e3)+u.thousandCharacter:e>1e3?(e/1e3).toFixed(1).replace(/\.0/,"")+u.thousandCharacter:e},bindEvents:function(e,i,s,o){function a(e,i,s){e.closest("li").bind("mouseenter",function(){n(this).closest("li").addClass("hover")}).bind("mouseleave",function(){n(this).closest("li").removeClass("hover")}),e.one("mouseover",function(){var e=n(this),o=e.closest("li"),a=r.clone(),f=n(i),l=n('<div class="button"/>').append(f),c,h,p=n.Deferred();p.promise().always(function(){var e=o.find("iframe");e.length?e.bind("load",function(){a.remove()}):a.remove()}),o.addClass(u.classes.active).append(a).append(l),s?(c=t.createElement("script"),c.src=s,c.attachEvent?c.attachEvent("onreadystatechange",function(){c.readyState==="complete"&&p.resolve()}):n(c).bind("load",p.resolve),t.body.appendChild(c)):f.is("iframe")&&p.resolve()})}o||(a(e.find(u.selectors.facebook+" a"),'<iframe src="//www.facebook.com/plugins/like.php?href='+encodeURI(i)+"&amp;send=false&amp;layout=button_count&amp;width=100&amp;show_faces=true&amp;action="+s+'&amp;colorscheme=light&amp;font=arial&amp;height=21" scrolling="no" frameborder="0" style="border:none; overflow:hidden;" allowTransparency="true"></iframe>'),a(e.find(u.selectors.twitter+" a"),'<a href="https://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a>',"//platform.twitter.com/widgets.js"),a(e.find(u.selectors.googleplus+" a"),'<div class="g-plusone" data-size="medium" data-annotation="none"></div>',"//apis.google.com/js/plusone.js"));var f=u.plugins.bind;for(var l=0,c=f.length;l<c;l++)f[l].call(e,a,i,o)}};n(function(){r=n("<div>").addClass("loading").html(u.isCssAnimations()?(new Array(4)).join('<div class="dot"></div>'):"Loading"),i=n("<span>").addClass(u.classes.countContent).html("&#160;"),n(u.initSelector).each(function(){var e=n(this);u.init(e)})}),window.SocialCount=u})(window,window.document,jQuery);